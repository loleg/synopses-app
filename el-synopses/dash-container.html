<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../bower_components/paper-styles/paper-styles.html">
<link rel="import" href="../bower_components/paper-material/paper-material.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">

<dom-module id="dash-container">
<style>
  :host {
    color: #757575;
    top: 20px;
    left: 20px;
    position: relative;
  }

  :host paper-header-panel {
    float: left;
    width: 320px;
    height: 300px;
    margin: 12px;
    @apply(--shadow-elevation-2dp);
  }

  .paper-header {
    height: 60px;
    font-size: 16px;
    line-height: 60px;
    padding: 0 10px;
    color: white;
    transition: height 0.2s;
  }

  .content {
    min-height: 240px;
    background-color: white;
    padding: 12px;
  }

  .blue .paper-header {
    background-color: var(--paper-light-blue-500);
  }
  .red .paper-header {
    background-color: var(--paper-red-500);
  }
  .orange .paper-header {
    background-color: var(--paper-amber-500);
  }
  .green .paper-header {
    background-color: var(--paper-green-500);
  }
  .cyan .paper-header {
    background-color: var(--paper-cyan-500);
  }
  .lime .paper-header {
    background-color: var(--paper-lime-500);
  }
  .pink .paper-header {
    background-color: var(--paper-pink-a200);
  }

  .content div.item {
    margin-top: 3px;
    padding-top: 3px;
    border-bottom: 1px solid #ccc;
  }
  .schedule span {
    width: 8em;
    margin-left: 1em;
    max-height: 2.4em;
    max-width: 10em;
    overflow: hidden;
    background: #fff;
  }
  .schedule date {
    opacity: 0.8;
    font-size: 80%;
  }
</style>
<template>
  <paper-header-panel class="blue">
    <div class="paper-header">Schedule</div>
    <div class="content schedule">
      <div class="flex layout vertical">
      <template is="dom-repeat" items="[[d_schedule]]">
        <div class="layout horizontal item">
          <date>{{item.date}}</date>
          <span>{{item.title}}</span>
        </div>
      </template>
      </div>
    </div>
  </paper-header-panel>
  <paper-header-panel class="blue">
    <div class="paper-header">Todo List/Notes</div>
    <div class="content notes">
      <div class="flex layout vertical">
      <template is="dom-repeat" items="[[d_notes]]">
        <div class="layout item">
          <from>{{item.title}}</from>
        </div>
      </template>
      </div>
    </div>
  </paper-header-panel>
  <paper-header-panel class="blue">
    <div class="paper-header">Colleagues</div>
    <div class="content users">
      <div class="flex layout vertical">
      <template is="dom-repeat" items="[[d_users]]">
        <div class="layout item">
          <from>{{item}}</from>
        </div>
      </template>
      </div>
    </div>
  </paper-header-panel>
  <paper-header-panel class="blue">
    <div class="paper-header">Inbox (Unread)</div>
    <div class="content inbox">
      <div class="flex layout vertical">
      <template is="dom-repeat" items="[[d_inbox]]">
        <div class="layout horizontal item">
          <from>{{item.from}}</from>
          <span>{{item.title}}</span>
        </div>
      </template>
      </div>
    </div>
  </paper-header-panel>
  <paper-header-panel class="blue">
    <div class="paper-header">Patient Map</div>
    <div class="content">

    </div>
  </paper-header-panel>
  <paper-header-panel class="blue">
    <div class="paper-header">Health Alerts</div>
    <div class="content">

    </div>
  </paper-header-panel>
</template>
<script>
  Polymer({
    is: 'dash-container',

    properties: {
      narrow: {
        type: Boolean,
        value: false,
        reflectToAttribute: true
      },

      d_schedule: {
        type: Array,
        value: function() { return []; }
      },

      d_notes: {
        type: Array,
        value: function() { return []; }
      },

      d_users: {
        type: Array,
        value: function() { return []; }
      },

      d_inbox: {
        type: Array,
        value: function() { return []; }
      },

      d_comms: {
        type: Array,
        value: function() { return []; }
      },

      d_alert: {
        type: Array,
        value: function() { return []; }
      },
    },

    ready: function() {
      var self = this;
      var ajax = document.createElement('iron-ajax');
      ajax.auto = true;
      ajax.url = '/api/threads';
      ajax.addEventListener('error', function(e) {
        console.warn(e);
      });
      ajax.addEventListener('response', function(e) {
        // console.log(e.detail.response);
        var ds = [], dn = [], dm = [], di = [];
        e.detail.response.threads.forEach(function(record) {
          record.messages.forEach(function(message) {
            if (message.icon == 'event') {
              ds.push({
                id: message.id, date: message.date,
                title: message.subject
              });
            } else if (message.icon == 'create') {
              dn.push({
                id: message.id, date: message.date,
                title: message.snippet
              });
            } else if (message.icon == 'accessibility') {
              di.push({
                id: message.id, date: message.date,
                from: message.from.name,
                title: message.snippet
              });
            }
          });
        });
        self.set('d_schedule', ds);
        self.set('d_notes', dn);
        self.set('d_inbox', di);
      });
      var ajax = document.createElement('iron-ajax');
      ajax.auto = true;
      ajax.url = '/api/users/list';
      ajax.addEventListener('error', function(e) {
        console.warn(e);
      });
      ajax.addEventListener('response', function(e) {
        // console.log(e.detail.response);
        self.set('d_users', e.detail.response.users);
      });
    } // -ready
  });
</script>
</dom-module>
