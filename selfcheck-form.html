<link rel="import" href="bower_components/polymer/polymer.html">
<link rel="import" href="bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="bower_components/paper-input/paper-input.html">
<link rel="import" href="bower_components/paper-radio-group/paper-radio-group.html">
<link rel="import" href="bower_components/paper-radio-button/paper-radio-button.html">
<link rel="import" href="bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="bower_components/iron-pages/iron-pages.html">
<link rel="import" href="bower_components/iron-autogrow-textarea/iron-autogrow-textarea.html">
<link rel="import" href="bower_components/pikaday-decorator/pikaday-decorator.html">

<dom-module id="selfcheck-form">
<style>
:host {
  --paper-toolbar-background: #00bcd4;
}

:host paper-tabs, :host paper-toolbar {
  background-color: #00bcd4;
  color: #fff;
  box-shadow: 0px 3px 6px rgba(0, 0, 0, 0.2);
}

:host paper-toolbar paper-tabs {
  box-shadow: none;
}

:host paper-tabs[noink][no-bar] paper-tab.iron-selected {
  color: #ffff8d;
}

:host form paper-icon-button {
  color: #333333;
}

:host label { margin-right:1em; }

#dropzone {
  -moz-border-radius: 5px;
  -webkit-border-radius: 5px;
  border-radius: 5px;
  padding: 20px 10px;
  text-align: center;
  font: 20pt bold 'Helvetica';
  color: #bbb;
  background: white;
}

#files {
  display: block;
  margin: 0 auto;;
}

#files::-webkit-file-upload-button {
  visibility: hidden;
}

#files::before {
  content: 'or click to select files';
  background: white;
  padding: 5px;
  outline: none;
  white-space: nowrap;
  -webkit-user-select: none;
  cursor: pointer;
  font-size: 16pt;
  margin: 0 auto;
}

#files:hover::before {
  border-color: black;
}

#files:active::before {
  background: -webkit-linear-gradient(top, #e3e3e3, #f9f9f9);
}

paper-radio-button.blue {
  --paper-radio-button-checked-color: var(--paper-light-blue-500);
  --paper-radio-button-checked-ink-color: var(--paper-light-blue-500);
  --paper-radio-button-unchecked-color: var(--paper-light-blue-900);
  --paper-radio-button-unchecked-ink-color: var(--paper-light-blue-900);
}

paper-radio-button.red {
  --paper-radio-button-checked-color: var(--paper-red-500);
  --paper-radio-button-checked-ink-color: var(--paper-red-500);
  --paper-radio-button-unchecked-color: var(--paper-red-900);
  --paper-radio-button-unchecked-ink-color: var(--paper-red-900);
}

paper-radio-button.green {
  --paper-radio-button-checked-color: var(--paper-green-500);
  --paper-radio-button-checked-ink-color: var(--paper-green-500);
  --paper-radio-button-unchecked-color: var(--paper-green-900);
  --paper-radio-button-unchecked-ink-color: var(--paper-green-900);
}

paper-radio-button.orange {
  --paper-radio-button-checked-color: var(--paper-orange-500);
  --paper-radio-button-checked-ink-color: var(--paper-orange-500);
  --paper-radio-button-unchecked-color: var(--paper-orange-900);
  --paper-radio-button-unchecked-ink-color: var(--paper-orange-900);
}

:host input, :host select, :host button {
  font-size: 16px;
}

pikaday-decorator {
  margin-bottom: 2em;
}
</style>
<template>
  <paper-dialog id="{{ ident }}" modal>
    <h2>{{ title }}</h2>

    <div class="record-SELFCHECK">
      <form is="iron-form" id="recordform" method="post" data-type="SELFCHECK" data-typeid="5">
        <div class="vertical layout">

          <h3>How are you?</h3>
          <div class="horizontal-section">
            <input type="hidden" name="selfcheck" id="selfcheck" value="">
            <paper-radio-group on-change="_onSetSelfCheck">
              <paper-radio-button class="green" name="better">Better</paper-radio-button>
              <paper-radio-button class="blue" name="same">The same</paper-radio-button>
              <paper-radio-button class="orange" name="worse">Worsening</paper-radio-button>
            </paper-radio-group>
          </div>

          <h3>Please elaborate:</h3>
          <iron-autogrow-textarea id="ta1" name="note" label="Note" required maxRows="16" rows="8">
            <textarea name="note" id="ta1" rows="6"></textarea>
          </iron-autogrow-textarea>

          <paper-input name="imageurl" label="Link to image file"></paper-input>
          <label hidden="true">
            <div id="dropzone" on-tap="{{tapSelect}}"
              on-dragover="{{handleDragOver}}"
              on-drop="{{handleFileSelect}}">
              Drag files to upload
              <input type="file" id="files" name="files[]"
                on-change="{{handleFilePick}}" multiple>
            </div>
          </label>

        </div>
      </form>
    </div>

    <div class="buttons">
      <paper-button dialog-dismiss>Cancel</paper-button>
      <paper-button raised on-tap="saveDialog">Save</paper-button>
    </div>
  </paper-dialog>
</template>
<script>
  Polymer({
    is: 'selfcheck-form',

    properties: {
      title: {
        value: "New self check",
        reflectToAttribute: true
      },
      recordType: {
        value: 1
      },
      patientHash: {
        value: document.location.search.replace('?', '')
      }
      //////
    },

    _onSetSelfCheck: function(e) {
      this.$.recordform.selfcheck.value = e.target.getAttribute('name');
    },

    saveDialog: function(e) {
      var the_form = this.$.recordform;
      the_form.action =
        '/api/patient/' + this.patientHash +
        '/record' + // single type
        '/save';
      the_form.submit();
      the_form.reset();
      var all_fields = the_form.querySelectorAll(
        'input[type="text"],gold-email-input,paper-input'
      );
      for (var i = 0; i < all_fields.length; i++) {
        if (typeof all_fields[i].value !== 'undefined') {
          all_fields[i].value = "";
        }
      }
      this.fire('record-saved');
      document.getElementById(this.ident).close();
    }

  });
</script>
</dom-module>
